class RouterElement extends HTMLElement{static handlerAddRouter(e){RouterElement.addRouter.call(this,e.detail.router),e.stopPropagation(),e.detail.parentRouter=this}static addRouter(e){this._routers.push(e)}static removeRouter(e){var t=this._routers.indexOf(e);t>-1&&this._routers.splice(t,1)}static changeHash(){let e=RouterElement._getHash();RouterElement.dispatch(_changeHash(e))}static changeUrl(){let e=RouterElement._getHash(),t=window.decodeURIComponent(window.location.pathname),r=window.location.search.substring(1),n=RouterElement._route;if(!RouterElement._initialized)return!1;if(n.path===window.decodeURIComponent(window.location.pathname)&&n.query===window.location.search.substring(1)&&n.hash===window.decodeURIComponent(window.location.hash.substring(1)))return!1;var o=RouterElement._getUrl(t,r,e);RouterElement.dispatch(o,t,r,e)}static handleClicks(e){if(e.defaultPrevented)return;var t=RouterElement._getSameOriginLinkHref(e);if(!t)return void e.target.dispatchEvent(new CustomEvent("onRouteNotHandled",{bubbles:!0,composed:!0,detail:{href:t}}));if(e.preventDefault(),t===window.location.href)return;let r=new URL(t),n=RouterElement._getHash(),o=window.decodeURIComponent(r.pathname),a=r.search.substring(1);var i=RouterElement._getUrl(o,a,n);RouterElement.dispatch(i,o,a,n)}static dispatch(e,t,r,n){let o=RouterElement.baseUrlSansHost(),a=e.substr(o.length);RouterElement._route={url:a,path:t,query:r,hash:n},RouterElement._activeRouters.length&&!1===RouterElement._activeRouters.every(e=>e.route.canLeave(RouterElement._route))?RouterElement._activeRouters[0].router.dispatchEvent(new CustomEvent("onRouteCancelled",{bubbles:!0,composed:!0,detail:{shortUrl:a}})):(RouterElement._activeRouters=[],RouterElement.performMatchOnRouters(a,t,r,n,RouterElement._routers),RouterElement.updateHistory(e))}static updateHistory(e){let t=RouterElement.getUrlState();t=2===t.length?e:document.baseURI+t;let r=new URL(t,window.location.protocol+"//"+window.location.host).href,n=RouterElement._route,o=window.performance.now(),a=n._lastChangedAt+RouterElement._dwellTime>o;n._lastChangedAt=o,a?window.history.replaceState({},"",r):window.history.pushState({},"",r)}static getUrlState(){let e=NamedRouting.generateNamedItemsUrl();if(RouterElement._routers)for(let r=0,n=RouterElement._routers.length;r<n;r++){var t=RouterElement._routers[r].generateUrlFragment();t&&(e.length&&(e+="::"),e+=t)}return e}static performMatchOnRouters(e,t,r,n,o){"("===e[0]&&(e=e.substr(1,e.length-2));let a=RouterElement.splitUrlIntoRouters(e),i=[];for(let e=0,t=a.length;e<t;e++)NamedRouting.parseNamedItem(a[e])||i.push(a[e]);let s=0;for(let e=o.length;s<e;s++){let e=o[s];i[s]&&e.performMatchOnRouter(i[s]||"")}}static splitUrlIntoRouters(e){for(var t=[],r=0,n=0,o=n,a=e.length;n<a;n++){const a=e[n];"("===a?r++:")"===a?r--:":"===a&&":"===e[n+1]&&0===r&&(t.push(e.substring(o+(":"===e[o]?1:0),n)),o=++n)}"("!==e[o]&&")"!==e[o]&&":"!==e[o]||o++,n>o&&t.push(e.substr(o));for(let e=0,r=t.length;e<r;e++)"/"===t[e][0]&&(t[e]=t[e].substr(1)),"("===t[e][0]&&")"===t[e][t[e].length-1]&&(t[e]=t[e].substr(1,t[e].length-2));return t}static urlForComponent(){}disconnectedCallback(){RouterElement.removeRouter.call(this._parentRouter,this),this.removeEventListener("routerAdded",this.addRouter,!1),this.getName()&&NamedRouting.removeNamedItem(this.getName())}connectedCallback(){if(!this.created){this.created=!0;let e=document.baseURI;if(void 0===e){let t=document.getElementsByTagName("base");e=t.length?t[0].href:document.URL,document.baseURI=e}this._routers=[],this.initialize()}if(this.isConnected){var e=new CustomEvent("onRouterAdded",{bubbles:!0,cancelable:!0,composed:!0,detail:{router:this}});this.dispatchEvent(e),this._parentRouter=e.detail.parentRouter,this.addEventListener("onRouterAdded",this.handlerAddRouter=RouterElement.handlerAddRouter.bind(this),!1),NamedRouting.addNamedItem(this)}}constructor(){super()}initialize(){RouterElement._initialized||(RouterElement._initialized=!0,RouterElement._activeRouters=[],RouterElement._route={},RouterElement._routers=[],RouterElement._encodeSpaceAsPlusInQuery=!1,RouterElement._dwellTime=2e3,RouterElement.whiteListRegEx=this.getAttribute("base-white-list")||"",window.addEventListener("popstate",RouterElement.changeUrl,!1),window.addEventListener("click",RouterElement.handleClicks,!1),window.addEventListener("onRouterAdded",RouterElement.handlerAddRouter.bind(RouterElement),!1),RouterElement.changeUrl(decodeURIComponent(location.pathname)))}getName(){return void 0===this.routerName&&(this.routerName=this.getAttribute("name")),this.routerName}getCurrentMatch(){if(!this._currentMatch&&this._parentRouter._currentMatch){this._currentMatch={remainder:this._parentRouter._currentMatch.remainder};let e=this._currentMatch.remainder;e&&"("===e[0]&&(e=RouterElement.splitUrlIntoRouters(e.substring(1,e.length-2)),this._currentMatch.remainder=e.shift()),this._currentMatch.url=this._currentMatch.remainder}return this._currentMatch}addRoute(e){if(console.log("route added: "+e.getAttribute("path")),!this.hasMatch){let t=this.getCurrentMatch();t?t.remainder&&this.performMatchOnRoute(t.remainder,e):this.performMatchOnRoute(RouterElement._route.url,e)}}processNamedUrl(e){return this.performMatchOnRouter(e)}performMatchOnRouter(e){this.hasMatch=!1,this._currentMatch={remainder:e};let t=this._getRouterElements("a-route"),r=this._getRouterElements("a-outlet")[0],n=null;for(let r=0,o=t.length;r<o;r++){let o=t[r];if(null!=(n=this.performMatchOnRoute(e,o))){console.log("route matched -> ",o.getAttribute("path"));break}}return null===n?(r.renderContent&&(r.renderContent("No matching route for url "+e+" \r\nTo replace this message add a 404 catch all route\r\n <a-route path='*'><template>catach all - NotFound</template></a-route>"),console&&console.error&&console.error("404 - Route not found for url "+e)),null):n}performMatchOnRoute(e,t){if(!t.match)return null;let r=t.match(e)||null;if(null!=r){if(r.redirect)return this.performMatchOnRouter(r.redirect);if(RouterElement._activeRouters.push({route:t,router:this,match:r}),this._currentMatch=r,r.useCache)this._routers&&r.remainder&&RouterElement.performMatchOnRouters(r.remainder,"","","",this._routers);else{let e=this._getRouterElements("a-outlet")[0];t.getContent(r.data).then(t=>e.renderContent(t))}this.postProcessMatch()}return r}postProcessMatch(){if(this.hasMatch=!0,this._parentRouter._currentMatch){let e=this._parentRouter._currentMatch.remainder;e&&"("===e[0]&&(e=e.substring(1,e.length-2)),(e=RouterElement.splitUrlIntoRouters(e)).shift(),e.length>1?this._parentRouter._currentMatch.remainder="("+e.join("::")+")":1===e.length?this._parentRouter._currentMatch.remainder=e[0]:this._parentRouter._currentMatch.remainder=""}}generateUrlFragment(){let e=this._currentMatch;if(!e)return"";let t=e.url;if(e.remainder&&(t+=e.remainder),this._routers&&this._routers.length){t+="/(";for(let e=0,r=this._routers.length;e<r;e++)e>0&&(t+="::"),t+=this._routers[e].generateUrlFragment();t+=")"}return t}_getRouterElements(e){let t=[];e=e.toLowerCase();for(var r=0,n=this.children.length;r<n;r++){let n=this.children[r];n.tagName.toLowerCase()===e&&t.push(n)}return t}static _getSameOriginLinkHref(e){if(0!==e.button)return null;if(e.metaKey||e.ctrlKey)return null;for(var t=e.path,r=null,n=0;n<t.length;n++){var o=t[n];if("A"===o.tagName&&o.href){r=o;break}}if(!r)return null;if("_blank"===r.target)return null;if(("_top"===r.target||"_parent"===r.target)&&window.top!==window)return null;if(r.download)return null;var a=r.href;if(0!==a.indexOf(document.baseURI))return null;var i,s,l,u=a.replace(/::/g,"$_$_");if(i=null!=document.baseURI?new URL(u,document.baseURI):new URL(u),s=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.host,i.origin&&"null"!==i.origin)l=i.origin;else{var h=i.host,c=i.port,d=i.protocol;("https:"===d&&"443"===c||"http:"===d&&"80"===c)&&(h=i.hostname),l=d+"//"+h}if(l!==s)return null;var m=i.pathname.replace(/\$_\$_/g,"::")+i.search.replace(/\$_\$_/g,"::")+i.hash.replace(/\$_\$_/g,"::");"/"!==m[0]&&(m="/"+m);let p=RouterElement._makeRegExp(RouterElement.whiteListRegEx);return p&&!p.test(m)?null:new URL(m,window.location.href).href}static _makeRegExp(e){return RegExp(e)}static _getHash(){return window.decodeURIComponent(window.location.hash.substring(1))}static baseUrlSansHost(){let e=window.location.protocol+"//"+window.location.host;return document.baseURI.substr(e.length+1)}static _getUrl(e,t,r){let n=window.encodeURI(e).replace(/\#/g,"%23").replace(/\?/g,"%3F"),o="";t&&(o="?"+t.replace(/\#/g,"%23"),o=RouterElement._encodeSpaceAsPlusInQuery?o.replace(/\+/g,"%2B").replace(/ /g,"+").replace(/%20/g,"+"):o.replace(/\+/g,"%2B").replace(/ /g,"%20"));var a="";return r&&(a="#"+window.encodeURI(r)),n+o+a}}RouterElement.assignedOutlets={},window.customElements.define("a-router",RouterElement);class RouteElement extends HTMLElement{connectedCallback(){if(!this.created){this.created=!0,this.style.display="none";const e=document.head.querySelector("base");this.baseUrl=e&&e.getAttribute("href")}if(this.isConnected){if(setTimeout(function(){this.parentNode&&this.parentNode.addRoute&&this.parentNode.addRoute(this)}.bind(this),0),this.hasAttribute("lazyload")&&"true"!==this.getAttribute("lazyload").toLowerCase()){let e=this.getAttribute("import"),t=this.getAttribute("element");e&&void 0===customElements.get(t)&&import(e)}}}disconnectedCallback(){this.parentNode&&this.parentNode.isConnected&&this.parentNode.removeRoute(this)}constructor(){super()}_createPathSegments(e){return e.replace(/(^\/+|\/+$)/g,"").split("/")}match(e){const t=this._createPathSegments(e),r=this.getAttribute("path");if(!r)throw console.log("route must contain a path"),"Route has no path defined. Add a path attribute to route";let n=null;if("*"===r)n={url:e,remainder:"",data:null};else if(r===e)n={url:e,remainder:"",data:null};else{const o=this._createPathSegments(r),a=new Map;let i=Math.max(t.length,o.length);for(let r=0;r<i;r++){if(o[r]&&":"===o[r].charAt(0)){let i=o[r].replace(/(^\:|[+*?]+$)/g,""),s=(o[r].match(/[+*?]+$/)||[])[0]||"",l=~s.indexOf("+"),u=~s.indexOf("*"),h=t[r]||"";if(!h&&!u&&(s.indexOf("?")<0||l)){n=null;break}if(a.set(i,decodeURIComponent(h)),l||u){a.set(i,t.slice(r).map(decodeURIComponent).join("/")),n={url:e,remainder:"",data:a};break}}else if(o[r]!==t[r]){r>0&&!this.hasAttribute("fullmatch")&&(n={url:t.slice(0,r).join("/"),remainder:t.slice(r).join("/"),data:a});break}r===i-1&&(n={url:e,remainder:"",data:a})}}if(null!==n){var o=new CustomEvent("onRouteMatch",{bubbles:!0,cancelable:!0,composed:!0,detail:{route:this,match:n,path:r}});this.dispatchEvent(o),o.defaultPrevented&&(n=null),this.hasAttribute("redirect")&&(n.redirect=this.getAttribute("redirect"))}if(n){let e=this.lastMatch&&this.lastMatch.url===n.url&&!this.hasAttribute("disableCache");n.useCache=e}return this.lastMatch=n,n}async getContent(e={}){let t=this.content;if(!t){let e=this.getAttribute("import"),r=this.getAttribute("element");await RouteElement.importCustomElement(e,r),r&&(t=document.createElement(r));let n=this.children[0];if(n&&"TEMPLATE"===n.nodeName)return n.content.cloneNode(!0)}return RouteElement.setData(t,e),this.content=t}static async importCustomElement(e,t){e&&void 0===customElements.get(t)&&await import(e)}static setData(e,t){t.forEach((t,r)=>{"."===r[0]?e[r.substr(1)]=t:e.setAttribute(r,t)})}canLeave(e){var t=new CustomEvent("onRouteLeave",{bubbles:!0,cancelable:!0,composed:!0,detail:{route:e}});return this.dispatchEvent(t),!t.defaultPrevented}}window.customElements.define("a-route",RouteElement);class OutletElement extends HTMLElement{connectedCallback(){this.isConnected&&(this.created||(this.created=!0,NamedRouting.addNamedItem(this)))}disconnectedCallback(){this.getName()&&NamedRouting.removeNamedItem(this.getName())}static deserializeDataFromUrl(e){let t=e.match(/^([\w-]+)(\(.*?\))?(?:\:(.+))?/);if(t){var r=new Map;if(t[3])for(var n=t[3].split("&"),o=0,a=n.length;o<a;o++){let e=n[o].split("=");r.set(decodeURIComponent(e[0]),decodeURIComponent(e[1]))}return{elementTag:t[1],data:r,options:{import:t[2]&&t[2].substr(1,t[2].length-2)}}}}constructor(){super()}getName(){return void 0===this.outletName&&(this.outletName=this.getAttribute("name")),this.outletName}_createPathSegments(e){return e.replace(/(^\/+|\/+$)/g,"").split("/")}renderContent(e){this.innerHTML="",console.log("outlet rendered: "+this.id),"string"==typeof e||e instanceof String?this.innerHTML=e:this.appendChild(e),this.dispatchEvent(new CustomEvent("onOutletUpdated",{bubbles:!0,composed:!0,detail:{}}))}async processNamedUrl(e,t){let r=OutletElement.deserializeDataFromUrl(e),n=r.options||{},o=r.data||new Map;o instanceof Map==!1&&(o=new Map(Object.entries(o||{}))),await RouteElement.importCustomElement(n.import,r.elementTag);let a=document.createElement(r.elementTag);return RouteElement.setData(a,o||{}),this.renderContent(a),t||RouterElement.updateHistory(""),a}}window.customElements.define("a-outlet",OutletElement);